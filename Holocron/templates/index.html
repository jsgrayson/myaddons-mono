{% extends 'base.html' %}

{% block content %}
<div class="row mb-4">
    <div class="col-md-12">
        <div class="card p-4 text-center">
            <h1 class="display-4 mb-3">Holocron Logistics</h1>
            <form action="/search" method="GET" class="d-flex justify-content-center">
                <input type="text" name="q" class="form-control w-50 me-2"
                    placeholder="Search for items (e.g., 'Sulfuron Hammer')..." value="{{ query if query else '' }}">
                <button type="submit" class="btn btn-primary">Search</button>
            </form>
        </div>
    </div>
</div>

{% if results %}
<div class="row mb-4">
    <div class="col-md-12">
        <h3>Search Results</h3>
        <table class="table table-dark table-striped">
            <thead>
                <tr>
                    <th>Item</th>
                    <th>Count</th>
                    <th>Location</th>
                    <th>Character</th>
                </tr>
            </thead>
            <tbody>
                {% for item in results %}
                <tr>
                    <td>{{ item.name }}</td>
                    <td>{{ item.count }}</td>
                    <td>{{ item.container_type }} ({{ item.container_index }})</td>
                    <td>{{ item.character_name }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>
{% endif %}

<div class="row">
    <div class="col-md-6">
        <div class="card">
            <div class="card-header">Total Account Value (Gold)</div>
            <div class="card-body">
                <canvas id="goldChart"></canvas>
            </div>
        </div>
    </div>
    <div class="col-md-6">
        <div class="card">
            <div class="card-header">System Status</div>
            <div class="card-body">
                <ul class="list-group list-group-flush">
                    <li class="list-group-item bg-transparent text-white">Database: <span
                            class="badge bg-success">Connected</span></li>
                    <li class="list-group-item bg-transparent text-white">Last Sync: <span class="text-muted">2 mins
                            ago</span></li>
                    <li class="list-group-item bg-transparent text-white">Pending Jobs: <span
                            class="badge bg-warning text-dark">3</span></li>
                </ul>
            </div>
        </div>
    </div>
</div>

<script>
    const ctx = document.getElementById('goldChart');
    new Chart(ctx, {
        type: 'line',
        data: {
            labels: ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'],
            datasets: [{
                label: 'Gold (Thousands)',
                data: [120, 190, 300, 500, 200, 300, 450],
                borderColor: '#ffd700',
                tension: 0.1
            }]
        },
        options: {
            scales: {
                y: { beginAtZero: true, grid: { color: '#333' } },
                x: { grid: { color: '#333' } }
            },
            plugins: { legend: { labels: { color: '#fff' } } }
        }
    });
</script>
{% endblock %}